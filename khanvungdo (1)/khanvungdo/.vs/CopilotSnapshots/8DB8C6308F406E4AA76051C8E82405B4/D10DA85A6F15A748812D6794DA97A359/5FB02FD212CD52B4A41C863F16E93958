using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using BussinessLogic.Services;
using DataAccess.Repositories;

namespace WindowsFormsApp2.Services
{
    // Facade dùng trong frmHome để tách logic gọi DB
    public class HomeFormService
    {
        private readonly SqlLoaiDichVuRepository _loaiRepo = new SqlLoaiDichVuRepository();
        private readonly SqlDichVuRepository _dvRepo = new SqlDichVuRepository();
        private readonly SqlHoaDonRepository _hdRepo = new SqlHoaDonRepository();
        private readonly InvoiceService _invoiceService = new InvoiceService();

        public IEnumerable<(int Id, string Name)> GetLoaiDichVu() => _loaiRepo.GetAll();

        public IEnumerable<BussinessLogic.Models.ServiceItem> GetDichVuTheoLoai(int loaiId) => _dvRepo.GetByLoaiId(loaiId);

        public int EnsureBillForRoom(int roomId) => _hdRepo.EnsureOpenInvoiceForRoom(roomId);

        public void AddServiceToBill(int billId, int dvId, int qty, string note) => _hdRepo.AddOrUpdateChiTiet(billId, dvId, qty, note);

        public void CloseBill(int billId, decimal discountPercent) => _hdRepo.CloseInvoice(billId, discountPercent);

        public decimal CalcTotal(decimal roomPrice, IEnumerable<Tuple<decimal,int>> sv, decimal discount) => _invoiceService.CalculateTotal(roomPrice, sv, discount);
    }
}
