using System;
using System.Data;
using System.Windows.Forms;
using System.Data.SqlClient;
using WindowsFormsApp2.Infrastructure;

namespace WindowsFormsApp2
{
    public partial class frmPhong : Form
    {
        public frmPhong()
        {
            InitializeComponent();
            Load += FrmPhong_Load;
        }

        private void FrmPhong_Load(object sender, EventArgs e)
        {
            LoadPhong();
        }

        private void LoadPhong()
        {
            lvDSPhong.Items.Clear();
            using (var conn = Db.Open())
            using (var cmd = new SqlCommand(@"SELECT p.id, p.TenPhong, p.status, p.MaKH, kh.TenKH
                                             FROM dbo.Phong p
                                             LEFT JOIN dbo.KhachHang kh ON kh.id = p.MaKH
                                             ORDER BY p.id", conn))
            using (var rd = cmd.ExecuteReader())
            {
                while (rd.Read())
                {
                    var tenPhong = rd["TenPhong"].ToString();
                    var status = rd["status"].ToString();
                    var tenKH = rd["TenKH"] == DBNull.Value ? string.Empty : rd["TenKH"].ToString();

                    var item = new ListViewItem(tenPhong);
                    item.SubItems.Add(""); // Số người
                    item.SubItems.Add(tenKH);
                    item.SubItems.Add(""); // Số DV
                    item.SubItems.Add(""); // Thành tiền
                    item.SubItems.Add(status);
                    lvDSPhong.Items.Add(item);
                    cbSoPhong.Items.Add(tenPhong);
                }
            }
        }
    }
}
