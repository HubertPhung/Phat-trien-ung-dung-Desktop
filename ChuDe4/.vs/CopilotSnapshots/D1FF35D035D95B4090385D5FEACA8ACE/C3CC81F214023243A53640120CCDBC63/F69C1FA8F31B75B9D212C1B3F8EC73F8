// DataAccess.cs
using System;
using System.Data;
using System.Data.SqlClient;

namespace ChuDe4
{
 /// <summary>
 /// Lớp truy cập dữ liệu đơn giản sử dụng SqlClient.
 /// Cung cấp các phương thức thực thi truy vấn trả về DataTable,
 /// lệnh không trả dữ liệu và lệnh trả về giá trị đơn.
 /// </summary>
 public class DataAccess
 {
 private readonly string _connectionString;

 public DataAccess()
 {
 // Chuỗi kết nối cố định cho bài lab
 _connectionString = "server=.; database=RestaurantManagement; Integrated Security=true;";
 }

 /// <summary>
 /// Thực thi câu lệnh SELECT và trả về dữ liệu dưới dạng DataTable.
 /// </summary>
 public DataTable ExecuteQuery(string query, params SqlParameter[] parameters)
 {
 using (var conn = new SqlConnection(_connectionString))
 using (var cmd = new SqlCommand(query, conn))
 using (var adapter = new SqlDataAdapter(cmd))
 {
 if (parameters != null && parameters.Length >0)
 {
 cmd.Parameters.AddRange(parameters);
 }

 var table = new DataTable();
 conn.Open();
 adapter.Fill(table);
 return table;
 }
 }

 /// <summary>
 /// Thực thi lệnh INSERT/UPDATE/DELETE, trả về số dòng bị ảnh hưởng.
 /// </summary>
 public int ExecuteNonQuery(string query, params SqlParameter[] parameters)
 {
 using (var conn = new SqlConnection(_connectionString))
 using (var cmd = new SqlCommand(query, conn))
 {
 if (parameters != null && parameters.Length >0)
 {
 cmd.Parameters.AddRange(parameters);
 }

 conn.Open();
 return cmd.ExecuteNonQuery();
 }
 }

 /// <summary>
 /// Thực thi lệnh trả về một giá trị (ví dụ SELECT COUNT(*)), trả về object.
 /// </summary>
 public object ExecuteScalar(string query, params SqlParameter[] parameters)
 {
 using (var conn = new SqlConnection(_connectionString))
 using (var cmd = new SqlCommand(query, conn))
 {
 if (parameters != null && parameters.Length >0)
 {
 cmd.Parameters.AddRange(parameters);
 }

 conn.Open();
 return cmd.ExecuteScalar();
 }
 }
 }
}