using System;
using System.Data;
using System.Data.SqlClient;
using System.Windows.Forms;

namespace ChuDe4
{
 public partial class AccountRolesForm : Form
 {
 private readonly int _accountId;
 private readonly string _username;
 private readonly DataAccess _db = new DataAccess();

 public AccountRolesForm(int accountId, string username)
 {
 InitializeComponent();
 _accountId = accountId;
 _username = username;
 }

 private void AccountRolesForm_Load(object sender, EventArgs e)
 {
 this.Text = $"Vai tr? c?a tài kho?n: {_username}";
 LoadRoles();
 }

 private void LoadRoles()
 {
 string query = @"SELECT r.RoleName, ar.IsActive
 FROM Roles r
 LEFT JOIN AccountRoles ar ON ar.RoleID = r.ID AND ar.AccountID = @AccountID
 ORDER BY r.RoleName";
 SqlParameter[] prms = { new SqlParameter("@AccountID", _accountId) };
 var table = _db.ExecuteQuery(query, prms);
 dgvRoles.DataSource = table;
 if (dgvRoles.Columns.Contains("RoleName")) dgvRoles.Columns["RoleName"].HeaderText = "Vai tr?";
 if (dgvRoles.Columns.Contains("IsActive")) dgvRoles.Columns["IsActive"].HeaderText = "Đang kích ho?t";
 dgvRoles.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill;
 }
 }
}
